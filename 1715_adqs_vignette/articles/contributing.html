<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contributing to admiral • admiral</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Contributing to admiral">
<meta property="og:description" content="admiral">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">admiral</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/admiral.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">User Guides</li>
    <li>
      <a href="../articles/adsl.html">Creating ADSL</a>
    </li>
    <li>
      <a href="../articles/occds.html">Creating an OCCDS ADaM</a>
    </li>
    <li>
      <a href="../articles/bds_finding.html">Creating a BDS Finding ADaM</a>
    </li>
    <li>
      <a href="../articles/imputation.html">Date and Time Imputation</a>
    </li>
    <li>
      <a href="../articles/faq.html">FAQ</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Developer Guides</li>
    <li>
      <a href="../articles/contributing.html">Contributing to admiral</a>
    </li>
    <li>
      <a href="../articles/git_usage.html">Guidance for git usage</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Roche-GSK/admiral/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="contributing_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Contributing to admiral</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Roche-GSK/admiral/blob/master/vignettes/contributing.Rmd"><code>vignettes/contributing.Rmd</code></a></small>
      <div class="hidden name"><code>contributing.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>As admiral is intended to be contributed by the user community, this article is meant for developers that want to either expand admiral functionalities or build on top of admiral. In order to keep the framework robust across the whole community, we have defined a programming strategy that should be followed in such cases. These contributions could include, for example, company specific derivations of ADaM datasets.</p>
</div>
<div id="functional-workflow" class="section level1">
<h1 class="hasAnchor">
<a href="#functional-workflow" class="anchor"></a>Functional Workflow</h1>
<ul>
<li>Overall programming will follow a functional approach.</li>
<li>Each ADaM dataset is built with a set of functions and not with free flow code.</li>
<li>Each ADaM dataset has a specific programming workflow.</li>
<li>Each function has a specific purpose that supports the ADaM Dataset programming workflow. It could be an admiral function or a company specific function.</li>
<li>Admiral functions can be re-used for company specific functions.</li>
<li>Each function belongs to a category or multiple categories.</li>
<li>Each function that is used to derive a or multiple variable(s) requires to be unit tested.</li>
<li>Functions do have a naming convention.</li>
<li>Double coding is not used as a QC method (only if absolutely necessary)</li>
<li>ADaMs are created including readable code and submission ready.</li>
</ul>
</div>
<div id="categorization-of-functions" class="section level1">
<h1 class="hasAnchor">
<a href="#categorization-of-functions" class="anchor"></a>Categorization of Functions</h1>
<p>The functions are categorized by keywords. The keywords can be specified in the function header via the <code>@keywords</code> field. Each function must use at least one of the following keywords.</p>
<table class="table">
<colgroup>
<col width="40%">
<col width="59%">
</colgroup>
<thead><tr class="header">
<th>Keyword</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>general_utility</td>
<td>A general function which performs a general functionality, like copy variables, check missing, create parameters.</td>
</tr>
<tr class="even">
<td>getadata</td>
<td>A function that provides Metadata functionality.</td>
</tr>
<tr class="odd">
<td>derivation</td>
<td>A function that derives one or more ADaM variable(s)</td>
</tr>
<tr class="even">
<td>assertion</td>
<td>Throws an error if a certain condition is not met and <code>NULL</code> otherwise</td>
</tr>
<tr class="odd">
<td>warning</td>
<td>Returns a warning message based on invalid data input or if existing variables are overwritten.</td>
</tr>
<tr class="even">
<td>predicate</td>
<td>Returns <code>TRUE</code> if the argument is a valid input, <code>FALSE</code> otherwise.</td>
</tr>
<tr class="odd">
<td>Across ADaM dataset structures keywords: ADaM</td>
<td>A function that is applicable across ADaM datasets.</td>
</tr>
<tr class="even">
<td>ADaM dataset structure specific keywords: ADSL, OCCDS, BDS, OTHER</td>
<td>A function specific to one of the ADaM dataset structures according to CDISC. Use the dataset structure as the keyword.</td>
</tr>
<tr class="odd">
<td>ADaM dataset specific keywords: ADEX, ADLB, …</td>
<td>A function specific to a ADaM dataset according to CDISC. Use the name of the corresponding ADaM dataset name as keyword</td>
</tr>
<tr class="even">
<td>timing</td>
<td>Function is related to timing, e.g., imputing dates, converting dates, deriving duration,, …</td>
</tr>
<tr class="odd">
<td>computation</td>
<td>Function which performs a computation that is used by other functions to derive a ADaM variable</td>
</tr>
<tr class="even">
<td>Therapeutic Area specific functions: Oncology, Infectious Diseases, Neuroscience</td>
<td>Functions that provide a particular algorithm for a specific therapeutic area.</td>
</tr>
<tr class="odd">
<td>Company specific keywords</td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div id="functions-in-r" class="section level1">
<h1 class="hasAnchor">
<a href="#functions-in-r" class="anchor"></a>Functions in R</h1>
<p>Functions in admiral must follow the modular approach, i.e., functions which add variables should add only a single variable except if other variables are closely related to the derived variable and can not be derived without it. For example <code>AAGE</code> (analysis age) and <code>AAGEU</code> (analysis age units) should be derived by the same function because it does not make sense to derive <code>AAGEU</code> without <code>AAGE</code>.</p>
<p>Variables like <code>BASE</code> (baseline value) and <code>BNRIND</code> (baseline reference range indicator) must be derived by two separate function calls as it is reasonable to derive only one of them.</p>
<div id="input-output-and-side-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#input-output-and-side-effects" class="anchor"></a>Input, Output, and Side-effects</h2>
<ul>
<li>The behavior of the function is only determined by its input, not by any global object. I.e., all input like datasets, variable names, options, … must be provided to the function by parameters.</li>
<li>It is expected that the input datasets are not grouped. If not, the function must issue an error.</li>
<li>If a function requires grouping, the function must provide the by_vars parameter.</li>
<li>The output dataset must be ungrouped.</li>
<li>If the function needs to create temporary variables in an input dataset, these variables must start with <code>temp_</code> and must be removed from the output dataset (link to remove function).</li>
<li>If the input dataset includes variables starting with <code>temp_</code>, an error must be issued (link to check function).</li>
<li>The function must not have any side-effects like creating or modifying global objects, printing, writing files, …</li>
</ul>
</div>
<div id="function-names" class="section level2">
<h2 class="hasAnchor">
<a href="#function-names" class="anchor"></a>Function Names</h2>
<ul>
<li>Function names should start with a verb and use snake case, e.g. <code><a href="../reference/derive_baseline.html">derive_baseline()</a></code>.</li>
</ul>
<table class="table">
<colgroup>
<col width="31%">
<col width="68%">
</colgroup>
<thead><tr class="header">
<th>Function name prefix</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>
<code>assert_</code> / <code>warn_</code> / <code>is_</code>
</td>
<td>Functions that check other functions’ inputs</td>
</tr>
<tr class="even">
<td><code>derive_</code></td>
<td>Functions that take a dataset as input and return a new dataset with additional rows and/or columns</td>
</tr>
<tr class="odd">
<td>
<code>derive_var_</code> (e.g. <code>derive_var_trtdurd</code>)</td>
<td>Functions which add a single variable</td>
</tr>
<tr class="even">
<td>
<code>derive_param_</code> (e.g. <code>derive_param_os</code>)</td>
<td>Functions which add a single parameter</td>
</tr>
<tr class="odd">
<td>
<code>compute_</code> / <code>calculate_</code> / …</td>
<td>Functions that take vectors as input and return a vector</td>
</tr>
</tbody>
</table>
</div>
<div id="function-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#function-parameters" class="anchor"></a>Function Parameters</h2>
<p>The default value of optional parameters should be <code>NULL</code>.</p>
<p>Names of variables inside a dataset should be passed as symbols rather than strings, i.e. <code>AVAL</code> rather than <code>"AVAL"</code>. If a parameter accepts one or more variables as input, the variables should be wrapped inside <code><a href="https://dplyr.tidyverse.org/reference/vars.html">vars()</a></code>.</p>
<p>For example:</p>
<ul>
<li><code>new_var = TEMPBL</code></li>
<li><code>by_vars = vars(PARAMCD, AVISIT)</code></li>
<li><code>filter = PARAMCD == "TEMP"</code></li>
<li><code>order = vars(AVISIT, desc(AESEV))</code></li>
</ul>
<p>Parameter must not accept expressions for assigning the value of the new variable. Instead separate parameters need to be provided for defining the value. For example if a function derives a variable which may be imputed, the following is <strong>not acceptable</strong>.</p>
<pre><code>    ...
    new_var = vars(mydtm = convert_dtc_to_dtm(impute_dtc(cmstdtc,
                                                         date_imputation = "last",
                                                         time_imputation = "last"))),
    ...</code></pre>
<p>Separate parameters for the imputation must be provided, e.g.:</p>
<pre><code>    ...
    new_var = mydtm,
    source_var = cmstdtc,
    date_imputation = "last",
    time_imputation = "last",
    ...</code></pre>
<p>Each function parameter needs to be tested with <code>assert_</code> type of function.</p>
<p>Each expression needs to be tested for the following: * whether it is an expression (or a list of expressions, depending on the function) * whether it is a valid expression (i.e. whether it evaluates without error) There is a utility function for that.</p>
</div>
<div id="common-function-parameters-naming-convention" class="section level2">
<h2 class="hasAnchor">
<a href="#common-function-parameters-naming-convention" class="anchor"></a>Common Function Parameters Naming Convention</h2>
<p>The first parameter of <code>derive_</code> functions should be the input dataset and it should be named <code>dataset</code>. If more than one input dataset is required, the other input dataset should start with <code>dataset_</code>, e.g., <code>dataset_ex.</code></p>
<p>Parameters for specifying items to add should start with <code>new_</code>. If a variable is added, the second part of the parameter name should be var, if a parameter is added, it should be <code>param.</code> For example: <code>new_var</code>, <code>new_var_unit</code>, <code>new_param</code>.</p>
<p>Parameters which expect a boolean or boolean vector must start with a verb, e.g., <code>is_imputed</code> or <code>impute_date</code>.</p>
</div>
<div id="list-of-common-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#list-of-common-parameters" class="anchor"></a>List of Common Parameters</h2>
<table class="table">
<colgroup>
<col width="13%">
<col width="86%">
</colgroup>
<thead><tr class="header">
<th>Parameter Name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>start_date</code></td>
<td>The start date of an event/interval. Expects a date object.</td>
</tr>
<tr class="even">
<td><code>end_date</code></td>
<td>The end date of an event/interval. Expects a date object.</td>
</tr>
<tr class="odd">
<td><code>start_dtc</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>dtc</code></td>
<td>(Partial) date/datetime in ISO 8601 format</td>
</tr>
<tr class="odd">
<td><code>by_vars</code></td>
<td>Variables to group by</td>
</tr>
<tr class="even">
<td><code>new_var</code></td>
<td>Name of a single variable to be added to the dataset</td>
</tr>
<tr class="odd">
<td><code>new_vars</code></td>
<td>List of variables to be added to the dataset</td>
</tr>
<tr class="even">
<td><code>new_var_unit</code></td>
<td>Name of the unit variable to be added. It should be the unit of the variable specified for the new_var parameter.</td>
</tr>
<tr class="odd">
<td><code>filter</code></td>
<td>Expression to filter a dataset, e.g., <code>PARAMCD == "TEMP"</code>
</td>
</tr>
<tr class="even">
<td><code>order</code></td>
<td>List of expressions for sorting a dataset, e.g., <code><a href="https://dplyr.tidyverse.org/reference/vars.html">vars(PARAMCD, AVISITN, desc(AVAL))</a></code>
</td>
</tr>
</tbody>
</table>
</div>
<div id="source-code-formatting" class="section level2">
<h2 class="hasAnchor">
<a href="#source-code-formatting" class="anchor"></a>Source Code Formatting</h2>
<p>All source code should be formatted according to the <a href="https://style.tidyverse.org/">tidyverse</a> style guide. The <a href="https://github.com/jimhester/lintr">lintr</a> package will be used to check and enforce this.</p>
</div>
<div id="input-checking" class="section level2">
<h2 class="hasAnchor">
<a href="#input-checking" class="anchor"></a>Input Checking</h2>
<p>In line with the <a href="https://en.wikipedia.org/wiki/Fail-fast">fail-fast</a> design principle function inputs should be checked for validity and if there’s an invalid input the function should stop immediately with an error. An exception is the case where a variable to-be-added by a function already exists in the input dataset: here only a warning should be displayed and the function should continue executing.</p>
<p>Inputs should be checked either using <code>asserthat::assert_that()</code> or custom assertion functions defined in <code>R/assertions.R</code>. These custom assertion functions should either return an error in case of an invalid input or return nothing.</p>
<p>For the most common types of input parameters like a single variable, a list of variables, a dataset, … functions for checking are available (see <a href="../reference/index.html#section-assertions">assertions</a>).</p>
<p>Parameter which expect keywords should handle them case-insensitive, e.g., both <code>date_imputation = "FIRST"</code> and <code>date_imputation = "first"</code> should be accepted.</p>
</div>
<div id="function-header" class="section level2">
<h2 class="hasAnchor">
<a href="#function-header" class="anchor"></a>Function Header</h2>
<p>Every function that is exported from the package must have an accompanying header that should be formatted according to the <a href="https://CRAN.R-project.org/package=pkgname">roxygen2</a> convention.</p>
<p>In addition to the roxygen2 parameters <code>@author</code> and <code>@keywords</code> are added in addition.</p>
<p>Author is the owner of the function while the keywords are used to categorize the function. Please see section “Categorization of functions”.</p>
<p>An example is given below:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r">#' Derive Analysis Study Day
#'
#' Adds the analysis study day (`ADY`) to the dataset, i.e., study day #' of analysis date.
#'
#' @param dataset Input dataset
#'
#'   The columns specified by the `reference_date` and the `date` parameter are
#'   expected.
#'
#' @param reference_date The start date column, e.g., date of first #'treatment
#'
#'   A date or date-time object column is expected.
#'
#'   The default is `TRTSDT`.
#'
#' @param date The end date column for which the study day should be #'derived
#'
#'   A date or date-time object column is expected.
#'
#'   The default is `ADT`
#'
#' @details The study day is derived as number of days from the start date
#'   to the end date. If it is non-negative, one is added. I.e., the study day of the
#'   start date is 1.
#'
#' @author Stefan Bundfuss
#'
#' @return The input dataset with `ADY` column added
#'
#' @keywords bds timing
#'
#' @export
#'
#' @examples
#' data </pre></body></html></div>
<p>The following fields are mandatory:</p>
<ul>
<li>
<code>@param</code>: One entry per function parameter. The following attributes should be described: expected data type (e.g. <code>data.frame</code>, <code>logical</code>, <code>numeric</code> etc.), default value (if any), permitted values (if applicable), optionality (i.e. is this a required parameter). If the expected input is a dataset then the required variables should be clearly stated.</li>
<li>
<code>@details</code>: A natural-language description of the derivation used inside the function.</li>
<li>
<code>@author</code>: The person who wrote the function. In case a function is later on updated by another person the name should be appended to the list of authors.</li>
<li>
<code>@keyword</code>: One or more keywords applicable to the function.</li>
<li>
<code>@return</code>: A description of the return value of the function.</li>
<li>
<code>@examples</code>: A fully-self contained example of how to use the function. Self-contained means that if this code is executed in a new R session it will run without errors. That requires any packages need to be loaded with <code>library()</code> and any datasets needed either to be created directly inside the example code or loaded using <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code>.</li>
</ul>
<p>Copying descriptions should be avoided as it makes the documentation hard to maintain. For example if the same parameter with the same description is used by more than one function, the parameter should be described for one function and the other functions should use <code>@inheritParams &lt;function name where the parameter is described&gt;</code>.</p>
<p>Please note that if <code>@inheritParams func_first</code> is used in the header of the <code>func_second()</code> function, those parameter descriptions of <code>func_first()</code> are included in the documentation of <code>func_second()</code> for which</p>
<ul>
<li>the parameter is offered by <code>func_second()</code> and</li>
<li>no <code>@param</code> tag for the parameter is included in the header of <code>func_second()</code>.</li>
</ul>
<p>The order of the <code>@param</code> tags should be the same as in the function definition. The <code>@inheritParams</code> tags should be after the <code>@param</code>. This does not affect the order of the parameter description in the rendered documentation but makes it easier to maintain the headers.</p>
<p>Variable names, expressions, functions, and any other code must be enclosed which backticks. This will render it as code.</p>
<p>For functions which derive a specific CDISC variable (i.e., those starting with <code>derive_var_</code>). The title must state the label of the variable without the variable name. The variable should be stated in the description.</p>
</div>
</div>
<div id="missing-values" class="section level1">
<h1 class="hasAnchor">
<a href="#missing-values" class="anchor"></a>Missing values</h1>
<p>Missing values (<code>NA</code>s) need to be explicitly shown.</p>
<p>Regarding character vectors converted from SAS files: SAS treats missing values as blank. Those are imported into R as empty strings (<code>""</code>) although in nature they are missing values (<code>NA</code>). All empty strings that originate like this need to be converted to proper R missing values <code>NA</code>.</p>
</div>
<div id="file-structuring" class="section level1">
<h1 class="hasAnchor">
<a href="#file-structuring" class="anchor"></a>File Structuring</h1>
<p>Organizing function into files is more of an art than a science. Thus, there are no hard rules but just recommendations. First and foremost, there are two extremes that should be avoided: putting each function into its own file and putting all functions into a single file. Apart from that the following recommendations should be taken into consideration when deciding upon file structuring:</p>
<ul>
<li>If a function is very long (together with its documentation), store it in a separate file</li>
<li>If some functions are documented together, put them into one file</li>
<li>If some functions have some sort of commonality or relevance with one another (like <code><a href="https://dplyr.tidyverse.org/reference/bind.html">dplyr::bind_rows()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/bind.html">dplyr::bind_cols()</a></code>), put them into one file</li>
<li>Store functions together with their helpers and methods</li>
<li>Have no more than 1000 lines in a single file, unless necessary (exceptions are, for example, classes with methods)</li>
</ul>
<p>It is the responsibility of both the author of a new function and reviewer to ensure that these recommendations are put into practice.</p>
</div>
<div id="r-package-dependencies" class="section level1">
<h1 class="hasAnchor">
<a href="#r-package-dependencies" class="anchor"></a>R Package Dependencies</h1>
<p>Package dependencies have to be documented in the <code>DESCRIPTION</code> file. If a package is used only in examples and/or unit tests then it should be listed in <code>Suggests</code>, otherwise in <code>Imports</code>.</p>
<p>Functions from other packages have to be explicitly imported by using the<code>@importFrom</code> tag in the <code>R/admiral-package.R</code> file. To import the <code>if_else</code> and <code>mutate</code> function from <code>dplyr</code> the following line would have to be included in that file: <code>#' @importFrom dplyr if_else mutate</code>.</p>
</div>
<div id="metadata" class="section level1">
<h1 class="hasAnchor">
<a href="#metadata" class="anchor"></a>Metadata</h1>
<p>Functions should only perform the derivation logic and not add any kind of metadata, e.g. labels.</p>
</div>
<div id="unit-testing" class="section level1">
<h1 class="hasAnchor">
<a href="#unit-testing" class="anchor"></a>Unit Testing</h1>
<p>Any function require a set of unit tests to verify they produce the expected result. If a function is defined in a file named <code>R/derive_baseline.R</code> then its accompanying unit tests should be stored in <code>tests/testthat/test-derive_baseline.R</code>.</p>
<p>The testing framework to be used is <a href="https://testthat.r-lib.org/">testthat</a>.</p>
<p>Unit tests should cover the functionality of the function. If another function g is called within a function f, the unit tests of f should not test the functionality of g. This should be tested by the unit tests of g, i.e., unit tests should be added at the lowest level.</p>
<p>The input and expected output for the unit tests must follow the following rules:</p>
<ul>
<li>Input and output should be as simple as possible.</li>
<li>Values should be hard-coded whenever possible.</li>
<li>If values need to be derived, only unit tested functions can be used.</li>
</ul>
<p>If a unit test fails, it must provide a helpful error message, e.g., if the output dataset is not as expected, the observations, variables, and values which differ should be provided. See also test helper function (link to be added).</p>
</div>
<div id="readable-code-for-adam" class="section level1">
<h1 class="hasAnchor">
<a href="#readable-code-for-adam" class="anchor"></a>Readable Code for ADaM</h1>
<p>General Guidance explaining the why and the definition of readable code: <a href="https://drive.google.com/file/d/107VOGN9lvKZfjBmz13fuiOYWpNoOVtgK/view">General Readable Code Guidance</a>.</p>
<div id="basic-rules" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-rules" class="anchor"></a>Basic Rules</h2>
<p>All R code that produces ADaM datasets should be based on readable code for their 1st line code. Producing Readable Code should not be part or the responsibility of any QC activities or 2nd line programming.</p>
<p>ADaMs in R will be highly modularized. This means code needs to be commented across the set of functions that produces the final ADaM dataset.</p>
<p>This guidance is built on the assumption that each ADaM dataset will have one R script that will call a set of functions needed to produce the corresponding ADaM dataset.</p>
</div>
<div id="header-for-the-main-r-script" class="section level2">
<h2 class="hasAnchor">
<a href="#header-for-the-main-r-script" class="anchor"></a>Header for the main R-Script</h2>
<p>The main R-script would contain all functional calls to create the ADaM dataset. In the header describe the ADaM dataset that will be produced:</p>
<ul>
<li>Name</li>
<li>Label</li>
<li>Input SDTMs and ADaMs</li>
<li>Short description of its purpose if not obvious by the label (novel endpoints mainly)</li>
</ul>
<div id="header-for-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#header-for-functions" class="anchor"></a>Header for functions</h3>
<ul>
<li>See Function header</li>
</ul>
</div>
<div id="functions" class="section level3">
<h3 class="hasAnchor">
<a href="#functions" class="anchor"></a>Functions</h3>
<ul>
<li>Function calls should have a preceding comment which is a short and meaningful description for which purpose the function is called, like:
<ul>
<li>Derive variable X if function name is not descriptive or if it is a customized variable.</li>
<li>Ideally use plain english to describe what a function is deriving.
<ul>
<li># derive analysis study day</li>
<li># derive age group &lt;= 18</li>
</ul>
</li>
<li>Impute date with missing days.</li>
<li>Check for missing values.</li>
</ul>
</li>
<li>A comment can cover multiple function calls that belong to a category or group of variables. Ideally one keeps it in line with the ADaM IG terminology, like Treatment Variables, Timing Variables, Identifier Variables as much as possible
<ul>
<li># derive all population indicator variables RANDFL, SAFFL …</li>
</ul>
</li>
<li>Functions that create user defined variables, specific to the molecule or study or support a specific endpoint should be called out specifically, like: the following function calls flag the special Adverse Events or a comment that highlights a molecule specific endoint</li>
<li>A function that covers a whole algorithm should have a preceding comment that indicates the purpose of the algorithm, like
<ul>
<li># derive secondary endpoint XYZ</li>
</ul>
</li>
</ul>
</div>
<div id="code" class="section level3">
<h3 class="hasAnchor">
<a href="#code" class="anchor"></a>Code</h3>
<p>The code itself should be described in meaningful plain english, so that a reviewer can understand how the piece of code works. E.g.</p>
<ul>
<li># calculates the sum of scores divided by the non missing numbers of scores to calculate the average score</li>
</ul>
<p>Code within function that creates a specific variable should have a starting comment and an ending comment. E.g.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># calculate X</span>
<span class="co"># describe how the code works in meaningful plain english</span>
 <span class="st">"&lt;code&gt;"</span>
<span class="co"># end of X</span></pre></body></html></div>
<p>If meaningful, comments can cover multiple variables within a piece of code</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># creates X, Y, Z</span>
<span class="co"># describe how the code works in meaningful plain english</span>
 <span class="st">"&lt;code&gt;"</span>
<span class="co"># end of X, Y, Z</span></pre></body></html></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Thomas Neitmann, Alice Ehmann, Stefan Bundfuss, Samia Kabi, Vignesh Thanikachalam, Ondrej Slama, Shimeng Huang, Robin Koeger, Gordon Miller.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '2d4895759f79e89d6eb1c3b990bca6d8',
    indexName: 'roche-gsk',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
